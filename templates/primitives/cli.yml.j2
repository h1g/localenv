cli:
  image: '{{ cli_image }}'
{% if os_name == 'linux' %}
  extra_hosts:
    - "host.docker.internal:{{ lookup('env','LE_NET_GW') }}"
{% endif %}
  volumes:
    - '{{ source_dir }}:/var/www'
    - '{{ home_dir }}/.ssh/:{{ home_dir }}/.ssh/'
    - '{{ home_dir }}/.gitconfig:{{ home_dir }}/.gitconfig'
{% if configs %}
    - {{ config_dir }}:{{ config_dir }}
{% endif %}
{% if  cache_dirs[tech] is defined %}
    - {{ cache_dirs[tech] }}
{% endif %}
  command: [ "bash" ]
{% for service in services.keys() if not (service in ['nginx','cli'] or (lookup('template', playbook_dir + '/templates/primitives/' + service + '.yml.j2')|from_yaml)[service]['image']|default(services[service]['image']) ==  cli_image + '_' + project + '_' + repo_name) %}
{% if loop.index == 1 %}
  depends_on:
{% endif %}
    - {{ project_name }}-{{ service }}
{% endfor %}
  stdin_open: true
  tty: true
