{{ project_name }}-images-pull:
	@docker-compose -f {{ service_dir }}/docker-compose.yml pull
{{ project_name }}-up:
	@docker-compose -f {{ service_dir }}/docker-compose.yml up -d
{{ project_name }}-down:
	@docker-compose -f {{ service_dir }}/docker-compose.yml down
{{ project_name }}-restart:  {{ project_name }}-down  {{ project_name }}-up
{% if 'cli' in services %}
{{ project_name }}-build:
	@docker-compose -f {{ service_dir }}/docker-compose.yml down
	@docker-compose -f {{ service_dir }}/docker-compose.yml build
	@docker-compose -f {{ service_dir }}/docker-compose.yml up -d {{ project_name }}-cli
	@docker exec {{ project_name }}-cli /build.sh
	@docker-compose -f {{ service_dir }}/docker-compose.yml up -d
{{ project_name }}-exec:
	@docker exec -ti {{ project_name }}-cli bash -l
{% endif %}
{% if project == 'dev' %}
sre:
	@sudo service docker restart
{% endif %}
{% if 'redis' in services %}
{{ project_name }}-exec-redis-cli:
	@docker exec -ti {{ project_name }}-redis redis-cli
{% endif %}
{% if 'workers' in services %}
{{ project_name }}-exec-workers:
	@docker exec -ti {{ project_name }}-workers bash -l
{% endif %}
{% if 'fpm' in services %}
{{ project_name }}-exec-fpm:
	@docker exec -ti {{ project_name }}-fpm bash -l
{% endif %}

{% for service in services if service in services_ports.keys() %}
{{ project_name }}-publish-{{ service }}:
	@docker ps -q --filter "name=dev-publish-{{ service }}" | grep -q . && docker stop dev-publish-{{ service }} || true
	@docker run -d --rm --name dev-publish-{{ service }} --publish {{ services_ports[service] }}:{{ services_ports[service] }} --network=localenv alpine/socat tcp-listen:{{ services_ports[service] }},fork,reuseaddr tcp-connect:{{ project_name }}-{{ service }}:{{ services_ports[service] }}
{% endfor %}
